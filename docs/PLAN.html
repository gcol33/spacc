<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>spacc C++ Refactoring Plan: Decoupling Core Logic from Rcpp • spacc</title><script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet"><meta property="og:title" content="spacc C++ Refactoring Plan: Decoupling Core Logic from Rcpp"></head><body><p>








  pkgdown/mathjax-config.html

  

  </p>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">spacc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Getting Started</h6></li>
    <li><a class="dropdown-item" href="articles/quickstart.html">Getting Started with spacc</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Guides</h6></li>
    <li><a class="dropdown-item" href="articles/diversity.html">Diversity Accumulation</a></li>
    <li><a class="dropdown-item" href="articles/extrapolation.html">Extrapolation and Species-Area Models</a></li>
    <li><a class="dropdown-item" href="articles/spatial-analysis.html">Spatial Analysis: Endemism, Fragmentation, and SAR</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gcol33/spacc"><span class="fa fab fa-github"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>spacc C++ Refactoring Plan: Decoupling Core Logic from Rcpp</h1>
      <small class="dont-index">Source: <a href="https://github.com/gcol33/spacc/blob/HEAD/plan.md" class="external-link"><code>plan.md</code></a></small>
    </div>

<div id="spacc-c-refactoring-plan-decoupling-core-logic-from-rcpp" class="section level1">

<div class="section level2">
<h2 id="goal">Goal<a class="anchor" aria-label="anchor" href="#goal"></a></h2>
<p>Separate pure C++ algorithms from Rcpp bindings to enable: 1. Standalone Catch2 testing of C++ code 2. Proper C++ code coverage metrics 3. Cleaner architecture and potential reuse (Python bindings, etc.)</p>
<hr></div>
<div class="section level2">
<h2 id="phase-1-create-core-header-structure">Phase 1: Create Core Header Structure<a class="anchor" aria-label="anchor" href="#phase-1-create-core-header-structure"></a></h2>
<div class="section level3">
<h3 id="id_11-create-srccore-directory">1.1 Create <code>src/core/</code> directory<a class="anchor" aria-label="anchor" href="#id_11-create-srccore-directory"></a></h3>
</div>
<div class="section level3">
<h3 id="id_12-extract-coretypesh---common-type-definitions">1.2 Extract <code>core/types.h</code> - Common type definitions<a class="anchor" aria-label="anchor" href="#id_12-extract-coretypesh---common-type-definitions"></a></h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">// Pure C++ types used across all core modules</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="kw">namespace</span> spacc <span class="op">{</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="kw">using</span> SiteSpeciesMatrix <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;&gt;;</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="kw">using</span> DistanceMatrix <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;&gt;;</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  <span class="kw">using</span> Curve <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;;</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="kw">using</span> CurveMatrix <span class="op">=</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;&gt;;</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  <span class="co">// ... etc</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_13-extract-coredistance_coreh---distance-calculations">1.3 Extract <code>core/distance_core.h</code> - Distance calculations<a class="anchor" aria-label="anchor" href="#id_13-extract-coredistance_coreh---distance-calculations"></a></h3>
<p>Functions to extract: - <code>euclidean_distance(x1, y1, x2, y2)</code> → double - <code>haversine_distance(lon1, lat1, lon2, lat2)</code> → double - <code>compute_distance_matrix(xs, ys, method)</code> → DistanceMatrix</p>
</div>
<div class="section level3">
<h3 id="id_14-extract-corebeta_coreh---beta-diversity-calculations">1.4 Extract <code>core/beta_core.h</code> - Beta diversity calculations<a class="anchor" aria-label="anchor" href="#id_14-extract-corebeta_coreh---beta-diversity-calculations"></a></h3>
<p>Functions to extract: - <code>struct BetaComponents { total, turnover, nestedness }</code> - <code>calc_beta_sorensen(a, b, c)</code> → BetaComponents - <code>calc_beta_jaccard(a, b, c)</code> → BetaComponents - <code>count_abc(set1, set2)</code> → tuple&lt;a,b,c&gt;</p>
</div>
<div class="section level3">
<h3 id="id_15-extract-corehill_coreh---hill-number-calculations">1.5 Extract <code>core/hill_core.h</code> - Hill number calculations<a class="anchor" aria-label="anchor" href="#id_15-extract-corehill_coreh---hill-number-calculations"></a></h3>
<p>Functions to extract: - <code>calc_hill_number(abundances, q)</code> → double - <code>calc_shannon_entropy(abundances)</code> → double - <code>calc_simpson_index(abundances)</code> → double</p>
</div>
<div class="section level3">
<h3 id="id_16-extract-corecoverage_coreh---coverage-calculations">1.6 Extract <code>core/coverage_core.h</code> - Coverage calculations<a class="anchor" aria-label="anchor" href="#id_16-extract-corecoverage_coreh---coverage-calculations"></a></h3>
<p>Functions to extract: - <code>calc_chao_coverage(abundances)</code> → double - <code>count_singletons(abundances)</code> → int - <code>count_doubletons(abundances)</code> → int</p>
</div>
<div class="section level3">
<h3 id="id_17-extract-coreaccumulation_coreh---core-accumulation-algorithms">1.7 Extract <code>core/accumulation_core.h</code> - Core accumulation algorithms<a class="anchor" aria-label="anchor" href="#id_17-extract-coreaccumulation_coreh---core-accumulation-algorithms"></a></h3>
<p>Functions to extract: - <code>knn_accumulate_single(species_pa, dist_mat, seed)</code> → Curve - <code>find_nearest_unvisited(dist_mat, current, visited)</code> → int - <code>accumulate_species(species_pa, site, seen)</code> → void</p>
</div>
<div class="section level3">
<h3 id="id_18-move-existing-headers-to-core">1.8 Move existing headers to core/<a class="anchor" aria-label="anchor" href="#id_18-move-existing-headers-to-core"></a></h3>
<ul><li>
<code>src/balltree.h</code> → <code>src/core/balltree.h</code>
</li>
<li>
<code>src/kdtree_adapter.h</code> → <code>src/core/kdtree_adapter.h</code>
</li>
</ul><hr></div>
</div>
<div class="section level2">
<h2 id="phase-2-refactor-rcpp-files-to-use-core-headers">Phase 2: Refactor Rcpp Files to Use Core Headers<a class="anchor" aria-label="anchor" href="#phase-2-refactor-rcpp-files-to-use-core-headers"></a></h2>
<div class="section level3">
<h3 id="id_21-refactor-srcdistancecpp">2.1 Refactor <code>src/distance.cpp</code>
<a class="anchor" aria-label="anchor" href="#id_21-refactor-srcdistancecpp"></a></h3>
<ul><li>Include <code>core/distance_core.h</code>
</li>
<li>Keep only Rcpp exports that wrap core functions</li>
<li>Convert: <code>NumericVector</code> → <code>std::vector&lt;double&gt;</code> → call core → convert back</li>
</ul></div>
<div class="section level3">
<h3 id="id_22-refactor-srcbetacpp">2.2 Refactor <code>src/beta.cpp</code>
<a class="anchor" aria-label="anchor" href="#id_22-refactor-srcbetacpp"></a></h3>
<ul><li>Include <code>core/beta_core.h</code>
</li>
<li>Remove <code>BetaComponents</code> struct (now in header)</li>
<li>Remove <code>calc_beta_sorensen</code>, <code>calc_beta_jaccard</code> (now in header)</li>
<li>Keep Rcpp workers that call core functions</li>
</ul></div>
<div class="section level3">
<h3 id="id_23-refactor-srchillcpp">2.3 Refactor <code>src/hill.cpp</code>
<a class="anchor" aria-label="anchor" href="#id_23-refactor-srchillcpp"></a></h3>
<ul><li>Include <code>core/hill_core.h</code>
</li>
<li>Remove pure calculation functions (now in header)</li>
<li>Keep Rcpp exports</li>
</ul></div>
<div class="section level3">
<h3 id="id_24-refactor-srccoveragecpp">2.4 Refactor <code>src/coverage.cpp</code>
<a class="anchor" aria-label="anchor" href="#id_24-refactor-srccoveragecpp"></a></h3>
<ul><li>Include <code>core/coverage_core.h</code>
</li>
<li>Remove pure calculation functions (now in header)</li>
<li>Keep Rcpp exports</li>
</ul></div>
<div class="section level3">
<h3 id="id_25-refactor-srcknncpp">2.5 Refactor <code>src/knn.cpp</code>
<a class="anchor" aria-label="anchor" href="#id_25-refactor-srcknncpp"></a></h3>
<ul><li>Include <code>core/accumulation_core.h</code>
</li>
<li>Extract core kNN logic</li>
<li>Keep Rcpp parallel workers</li>
</ul></div>
<div class="section level3">
<h3 id="id_26-refactor-srckncncpp">2.6 Refactor <code>src/kncn.cpp</code>
<a class="anchor" aria-label="anchor" href="#id_26-refactor-srckncncpp"></a></h3>
<ul><li>Include <code>core/accumulation_core.h</code>
</li>
<li>Similar pattern</li>
</ul></div>
<div class="section level3">
<h3 id="id_27-refactor-srcrandomcpp">2.7 Refactor <code>src/random.cpp</code>
<a class="anchor" aria-label="anchor" href="#id_27-refactor-srcrandomcpp"></a></h3>
<ul><li>Include <code>core/accumulation_core.h</code>
</li>
<li>Similar pattern</li>
</ul></div>
<div class="section level3">
<h3 id="id_28-refactor-srcmetricscpp">2.8 Refactor <code>src/metrics.cpp</code>
<a class="anchor" aria-label="anchor" href="#id_28-refactor-srcmetricscpp"></a></h3>
<ul><li>Include relevant core headers</li>
<li>Extract pure metric calculations</li>
</ul></div>
<div class="section level3">
<h3 id="id_29-refactor-srcphylocpp">2.9 Refactor <code>src/phylo.cpp</code>
<a class="anchor" aria-label="anchor" href="#id_29-refactor-srcphylocpp"></a></h3>
<ul><li>Include relevant core headers</li>
<li>Extract phylogenetic calculations</li>
</ul></div>
<div class="section level3">
<h3 id="id_210-refactor-srcmethodscpp">2.10 Refactor <code>src/methods.cpp</code>
<a class="anchor" aria-label="anchor" href="#id_210-refactor-srcmethodscpp"></a></h3>
<ul><li>Include relevant core headers</li>
<li>Extract any pure C++ logic</li>
</ul><hr></div>
</div>
<div class="section level2">
<h2 id="phase-3-create-catch2-test-suite">Phase 3: Create Catch2 Test Suite<a class="anchor" aria-label="anchor" href="#phase-3-create-catch2-test-suite"></a></h2>
<div class="section level3">
<h3 id="id_31-setup-test-infrastructure">3.1 Setup test infrastructure<a class="anchor" aria-label="anchor" href="#id_31-setup-test-infrastructure"></a></h3>
<pre><code>src/tests/
├── catch.hpp           # Already copied
├── test_main.cpp       # Already created
├── Makefile            # Build system
├── run_tests.bat       # Windows runner
└── run_coverage.bat    # Coverage runner</code></pre>
</div>
<div class="section level3">
<h3 id="id_32-create-test_distancecpp">3.2 Create <code>test_distance.cpp</code>
<a class="anchor" aria-label="anchor" href="#id_32-create-test_distancecpp"></a></h3>
<ul><li>Test euclidean_distance with known values</li>
<li>Test haversine_distance with known values</li>
<li>Test distance matrix computation</li>
<li>Edge cases: same point, antipodal points</li>
</ul></div>
<div class="section level3">
<h3 id="id_33-create-test_betacpp">3.3 Create <code>test_beta.cpp</code>
<a class="anchor" aria-label="anchor" href="#id_33-create-test_betacpp"></a></h3>
<ul><li>Test calc_beta_sorensen with known a,b,c values</li>
<li>Test calc_beta_jaccard with known a,b,c values</li>
<li>Verify turnover + nestedness = total</li>
<li>Edge cases: all shared, no shared, empty sets</li>
</ul></div>
<div class="section level3">
<h3 id="id_34-create-test_hillcpp">3.4 Create <code>test_hill.cpp</code>
<a class="anchor" aria-label="anchor" href="#id_34-create-test_hillcpp"></a></h3>
<ul><li>Test q=0 (species richness)</li>
<li>Test q=1 (Shannon exponential)</li>
<li>Test q=2 (inverse Simpson)</li>
<li>Edge cases: single species, uniform abundances, highly skewed</li>
</ul></div>
<div class="section level3">
<h3 id="id_35-create-test_coveragecpp">3.5 Create <code>test_coverage.cpp</code>
<a class="anchor" aria-label="anchor" href="#id_35-create-test_coveragecpp"></a></h3>
<ul><li>Test Chao coverage formula</li>
<li>Test singleton/doubleton counting</li>
<li>Edge cases: no singletons, all singletons</li>
</ul></div>
<div class="section level3">
<h3 id="id_36-create-test_accumulationcpp">3.6 Create <code>test_accumulation.cpp</code>
<a class="anchor" aria-label="anchor" href="#id_36-create-test_accumulationcpp"></a></h3>
<ul><li>Test kNN single curve with simple matrix</li>
<li>Test species accumulation logic</li>
<li>Verify monotonic increase</li>
</ul><hr></div>
</div>
<div class="section level2">
<h2 id="phase-4-build-system--coverage">Phase 4: Build System &amp; Coverage<a class="anchor" aria-label="anchor" href="#phase-4-build-system--coverage"></a></h2>
<div class="section level3">
<h3 id="id_41-create-srctestsmakefile">4.1 Create <code>src/tests/Makefile</code>
<a class="anchor" aria-label="anchor" href="#id_41-create-srctestsmakefile"></a></h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="dt">CXX</span> <span class="ch">=</span><span class="st"> g++</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="dt">CXXFLAGS</span> <span class="ch">=</span><span class="st"> -std=c++17 -Wall -Wextra -I../core -I.</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="dt">COV_FLAGS</span> <span class="ch">=</span><span class="st"> --coverage -fprofile-arcs -ftest-coverage -O0 -g</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="dt">TESTS</span> <span class="ch">=</span><span class="st"> test_main.cpp test_distance.cpp test_beta.cpp test_hill.cpp </span><span class="ch">\</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="st">        test_coverage.cpp test_accumulation.cpp</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="dv">all:</span><span class="dt"> run_tests</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="er">    </span>./run_tests</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="dv">run_tests:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">TESTS</span><span class="ch">)</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CXX</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CXXFLAGS</span><span class="ch">)</span> -O2 -o <span class="ch">$@</span> <span class="ch">$^</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="dv">coverage:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">TESTS</span><span class="ch">)</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CXX</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">CXXFLAGS</span><span class="ch">)</span> <span class="ch">$(</span><span class="dt">COV_FLAGS</span><span class="ch">)</span> -o run_tests_cov <span class="ch">$^</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a>    ./run_tests_cov</span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>    gcov *.cpp</span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="er">    </span>rm -f run_tests run_tests_cov *.gcov *.gcda *.gcno</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_42-create-srctestsrun_testsbat">4.2 Create <code>src/tests/run_tests.bat</code>
<a class="anchor" aria-label="anchor" href="#id_42-create-srctestsrun_testsbat"></a></h3>
<pre class="batch"><code>@echo off
set PATH=C:\rtools45\x86_64-w64-mingw32.static.posix\bin;%PATH%
g++ -std=c++17 -Wall -I../core -I. -O2 -o run_tests.exe ^
    test_main.cpp test_distance.cpp test_beta.cpp test_hill.cpp ^
    test_coverage.cpp test_accumulation.cpp
run_tests.exe %*</code></pre>
</div>
<div class="section level3">
<h3 id="id_43-create-srctestsrun_coveragebat">4.3 Create <code>src/tests/run_coverage.bat</code>
<a class="anchor" aria-label="anchor" href="#id_43-create-srctestsrun_coveragebat"></a></h3>
<pre class="batch"><code>@echo off
set PATH=C:\rtools45\x86_64-w64-mingw32.static.posix\bin;%PATH%
g++ -std=c++17 -Wall -I../core -I. --coverage -O0 -g -o run_tests_cov.exe ^
    test_main.cpp test_distance.cpp test_beta.cpp test_hill.cpp ^
    test_coverage.cpp test_accumulation.cpp
run_tests_cov.exe
gcov *.cpp 2&gt;nul | findstr /C:"File" /C:"Lines"</code></pre>
<hr></div>
</div>
<div class="section level2">
<h2 id="phase-5-verification--cleanup">Phase 5: Verification &amp; Cleanup<a class="anchor" aria-label="anchor" href="#phase-5-verification--cleanup"></a></h2>
<div class="section level3">
<h3 id="id_51-verify-r-package-still-builds">5.1 Verify R package still builds<a class="anchor" aria-label="anchor" href="#id_51-verify-r-package-still-builds"></a></h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/check.html" class="external-link">check</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_52-verify-all-r-tests-still-pass">5.2 Verify all R tests still pass<a class="anchor" aria-label="anchor" href="#id_52-verify-all-r-tests-still-pass"></a></h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/test.html" class="external-link">test</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_53-run-c-tests">5.3 Run C++ tests<a class="anchor" aria-label="anchor" href="#id_53-run-c-tests"></a></h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="bu">cd</span> src/tests</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="ex">./run_tests.bat</span>        <span class="co"># Windows</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="fu">make</span> all               <span class="co"># Unix</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_54-check-c-coverage">5.4 Check C++ coverage<a class="anchor" aria-label="anchor" href="#id_54-check-c-coverage"></a></h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="bu">cd</span> src/tests</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="ex">./run_coverage.bat</span>     <span class="co"># Windows</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="fu">make</span> coverage          <span class="co"># Unix</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="id_55-update-rbuildignore">5.5 Update .Rbuildignore<a class="anchor" aria-label="anchor" href="#id_55-update-rbuildignore"></a></h3>
<p>Add <code>src/tests/</code> to exclude test files from R package build</p>
</div>
<div class="section level3">
<h3 id="id_56-commit-and-document">5.6 Commit and document<a class="anchor" aria-label="anchor" href="#id_56-commit-and-document"></a></h3>
<ul><li>Commit refactored code</li>
<li>Update CLAUDE.md with new structure</li>
<li>Document how to run C++ tests</li>
</ul><hr></div>
</div>
<div class="section level2">
<h2 id="file-checklist">File Checklist<a class="anchor" aria-label="anchor" href="#file-checklist"></a></h2>
<div class="section level3">
<h3 id="new-files-to-create">New files to create:<a class="anchor" aria-label="anchor" href="#new-files-to-create"></a></h3>
<ul class="task-list"><li><label><input type="checkbox"><code>src/core/types.h</code></label></li>
<li><label><input type="checkbox"><code>src/core/distance_core.h</code></label></li>
<li><label><input type="checkbox"><code>src/core/beta_core.h</code></label></li>
<li><label><input type="checkbox"><code>src/core/hill_core.h</code></label></li>
<li><label><input type="checkbox"><code>src/core/coverage_core.h</code></label></li>
<li><label><input type="checkbox"><code>src/core/accumulation_core.h</code></label></li>
<li><label><input type="checkbox"><code>src/tests/test_distance.cpp</code></label></li>
<li><label><input type="checkbox"><code>src/tests/test_beta.cpp</code></label></li>
<li><label><input type="checkbox"><code>src/tests/test_hill.cpp</code></label></li>
<li><label><input type="checkbox"><code>src/tests/test_coverage.cpp</code></label></li>
<li><label><input type="checkbox"><code>src/tests/test_accumulation.cpp</code></label></li>
<li><label><input type="checkbox"><code>src/tests/Makefile</code></label></li>
<li><label><input type="checkbox"><code>src/tests/run_tests.bat</code></label></li>
<li><label><input type="checkbox"><code>src/tests/run_coverage.bat</code></label></li>
</ul></div>
<div class="section level3">
<h3 id="files-to-modify">Files to modify:<a class="anchor" aria-label="anchor" href="#files-to-modify"></a></h3>
<ul class="task-list"><li><label><input type="checkbox"><code>src/distance.cpp</code> - use core/distance_core.h</label></li>
<li><label><input type="checkbox"><code>src/beta.cpp</code> - use core/beta_core.h</label></li>
<li><label><input type="checkbox"><code>src/hill.cpp</code> - use core/hill_core.h</label></li>
<li><label><input type="checkbox"><code>src/coverage.cpp</code> - use core/coverage_core.h</label></li>
<li><label><input type="checkbox"><code>src/knn.cpp</code> - use core/accumulation_core.h</label></li>
<li><label><input type="checkbox"><code>src/kncn.cpp</code> - use core/accumulation_core.h</label></li>
<li><label><input type="checkbox"><code>src/random.cpp</code> - use core/accumulation_core.h</label></li>
<li><label><input type="checkbox"><code>src/metrics.cpp</code> - use core headers</label></li>
<li><label><input type="checkbox"><code>src/phylo.cpp</code> - use core headers</label></li>
<li><label><input type="checkbox"><code>src/methods.cpp</code> - use core headers</label></li>
<li><label><input type="checkbox"><code>.Rbuildignore</code> - exclude src/tests/</label></li>
</ul></div>
<div class="section level3">
<h3 id="files-to-move">Files to move:<a class="anchor" aria-label="anchor" href="#files-to-move"></a></h3>
<ul class="task-list"><li><label><input type="checkbox"><code>src/balltree.h</code> → <code>src/core/balltree.h</code></label></li>
<li><label><input type="checkbox"><code>src/kdtree_adapter.h</code> → <code>src/core/kdtree_adapter.h</code></label></li>
</ul><hr></div>
</div>
<div class="section level2">
<h2 id="expected-outcome">Expected Outcome<a class="anchor" aria-label="anchor" href="#expected-outcome"></a></h2>
<p>After completion: 1. <strong>C++ tests</strong>: 50+ Catch2 tests covering core algorithms 2. <strong>C++ coverage</strong>: 80%+ on core/ headers 3. <strong>Clean architecture</strong>: Pure C++ separated from Rcpp bindings 4. <strong>Fast iteration</strong>: C++ tests run in &lt;1 second 5. <strong>R package</strong>: Unchanged functionality, all tests pass</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gilles Colling.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  
</body></html>

