% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/spacc.R
\name{spacc}
\alias{spacc}
\title{Spatial Species Accumulation Curves}
\usage{
spacc(
  x,
  coords,
  n_seeds = 50L,
  method = c("knn", "kncn", "random", "radius", "gaussian", "cone", "collector"),
  distance = c("euclidean", "haversine"),
  backend = c("auto", "exact", "kdtree"),
  support = NULL,
  include_halo = TRUE,
  sigma = NULL,
  cone_width = pi/4,
  parallel = TRUE,
  n_cores = NULL,
  progress = TRUE,
  groups = NULL,
  time = NULL,
  w_space = 1,
  w_time = 1,
  seed = NULL
)
}
\arguments{
\item{x}{A site-by-species matrix (rows = sites, cols = species) with
presence/absence (0/1) or abundance data. Can also be a data.frame.}

\item{coords}{Site coordinates. Can be:
\itemize{
\item A data.frame with columns \code{x} and \code{y}
\item An \code{sf} object with point geometries (CRS is preserved)
\item A \code{spacc_dist} object from \code{\link[=distances]{distances()}}
}}

\item{n_seeds}{Integer. Number of random starting points for uncertainty
quantification. Default 50.}

\item{method}{Character. Accumulation method:
\itemize{
\item \code{"knn"}: k-Nearest Neighbor (always visit closest unvisited)
\item \code{"kncn"}: k-Nearest Centroid Neighbor (visit closest to centroid)
\item \code{"random"}: Random order (null model)
\item \code{"radius"}: Expand by distance from seed
\item \code{"gaussian"}: Probabilistic selection weighted by distance
\item \code{"cone"}: Directional expansion within angular constraint
\item \code{"collector"}: Sites in data order (no randomization, single curve)
}}

\item{distance}{Character. Distance method: \code{"euclidean"} or \code{"haversine"}.}

\item{backend}{Character. Nearest-neighbor backend for \code{knn} and \code{kncn}:
\itemize{
\item \code{"auto"} (default): Uses exact (brute-force) for â‰¤500 sites,
spatial tree for >500 sites.
\item \code{"exact"}: Always use brute-force with precomputed distance matrix.
\item \code{"kdtree"}: Always use spatial tree. Uses k-d tree (nanoflann) for
Euclidean distances and ball tree for haversine distances. Faster for
large datasets, no distance matrix needed.
}}

\item{support}{Optional. Spatial support for core/halo classification via
\code{\link[areaOfEffect:aoe]{areaOfEffect::aoe()}}. Can be:
\itemize{
\item \code{"auto"}: Auto-detect countries and run per-country accumulation,
returning a grouped \code{spacc} object with one curve per country
\item Country name or ISO code: \code{"France"}, \code{"FR"}, \code{"FRA"}
\item Vector of countries: \code{c("France", "Germany")}
\item An \code{sf} polygon object
\item An \code{aoe_result} object (pre-computed)
When provided, seeds are sampled only from "core" sites (inside support),
while accumulation can expand into "halo" sites (buffer zone).
}}

\item{include_halo}{Logical. When \code{support} is provided, should halo sites
be included in accumulation? Default \code{TRUE} (ecological boundary).
Set to \code{FALSE} for political/hard boundary.}

\item{sigma}{Numeric. Bandwidth for Gaussian method. Default auto-calculated.}

\item{cone_width}{Numeric. Half-width in radians for cone method. Default pi/4.}

\item{parallel}{Logical. Use parallel processing? Default \code{TRUE}.}

\item{n_cores}{Integer. Number of cores. Default \code{NULL} uses \code{detectCores() - 1}.}

\item{progress}{Logical. Show progress bar? Default \code{TRUE}.}

\item{groups}{Optional. A factor, character, or integer vector of length
\code{ncol(x)} assigning each species (column) to a group. When provided,
separate accumulation curves are computed for each group using the
\strong{same spatial site ordering}, and a grouped \code{spacc} object is returned.
Useful for comparing native vs alien species, families, or any
categorical split. Default \code{NULL} (no grouping).}

\item{time}{Optional. Numeric vector of length \code{nrow(x)} giving a temporal
coordinate for each site. When provided, a combined spatiotemporal distance
matrix is computed as \code{w_space * d_spatial + w_time * d_temporal} and used
for accumulation. Forces exact (brute-force) backend since spatial trees
cannot handle composite distances. Only supported for methods that use a
distance matrix: \code{"knn"}, \code{"radius"}, \code{"gaussian"}.}

\item{w_space}{Numeric. Weight for spatial distance when \code{time} is provided.
Default 1.}

\item{w_time}{Numeric. Weight for temporal distance when \code{time} is provided.
Default 1.}

\item{seed}{Integer. Random seed for reproducibility. Default \code{NULL}.}
}
\value{
When \code{groups = NULL}, an object of class \code{spacc} containing:
\item{curves}{Matrix of cumulative species counts (n_seeds x n_sites)}
\item{coords}{Original coordinates}
\item{n_seeds}{Number of seeds used}
\item{method}{Method used}
\item{n_species}{Total species in dataset}
}
\description{
Compute species accumulation curves using various spatial sampling methods
with C++ backend for performance.
}
\examples{
\dontrun{
# Basic usage
sac <- spacc(species, coords)
plot(sac)

# Different methods
sac_knn <- spacc(species, coords, method = "knn")
sac_gauss <- spacc(species, coords, method = "gaussian", sigma = 10)
sac_cone <- spacc(species, coords, method = "cone", cone_width = pi/6)

# Compare to null model
sac_rand <- spacc(species, coords, method = "random")
comp <- compare(sac_knn, sac_rand)

# With spatial support (seeds from France, accumulate into neighbors)
sac_france <- spacc(species, coords, support = "France")

# Hard boundary (France only, no halo)
sac_france_only <- spacc(species, coords, support = "France", include_halo = FALSE)

# Grouped accumulation (e.g., native vs alien)
status <- ifelse(grepl("alien", colnames(species)), "alien", "native")
sac_grouped <- spacc(species, coords, groups = status, seed = 42)
plot(sac_grouped)  # Overlaid curves per group
}

}
\references{
Arrhenius, O. (1921). Species and area. Journal of Ecology, 9, 95-99.

Scheiner, S.M. (2003). Six types of species-area curves. Global Ecology
and Biogeography, 12, 441-447.

Chiarucci, A., Bacaro, G., Scheiner, S.M. (2011). Old and new challenges
in using species diversity for assessing biodiversity. Philosophical
Transactions of the Royal Society B, 366, 2426-2437.
}
